datasource db {
  provider = "postgresql"
}
generator client {
  provider = "prisma-client-js"
}
model Item {
  id              Int @id @default(autoincrement())
  tenantId         Int
  itemName        String
  itemVariety     String
  packingType     String
  itemDescription String
  shipmentItems   ShipmentItem[]
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model BillingAddress {
  id              Int @id @default(autoincrement())
  tenantId        Int
  addressLine1    String
  addressLine2    String?
  cityOrDistrict  String
  stateOrProvince String
  postalCode      Int
  businesses      Business[]
}

model ShippingAddress {
  id              Int @id @default(autoincrement())
  tenantId        Int
  addressLine1    String
  addressLine2    String?
  cityOrDistrict  String
  stateOrProvince String
  postalCode      Int
  shipments       Shipment[]
}

model Business {
  id                Int @id @default(autoincrement())
  tenantId        Int
  businessName      String
  contactPersonName String
  phoneNumber       String
  email             String
  billingAddressId Int
  billingAddress   BillingAddress @relation(fields: [billingAddressId], references: [id])
  shipments        Shipment[]
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
}

model Driver {
  id                   Int      @id @default(autoincrement())
  Drivername           String
  phoneNumber          String
  alternatePhoneNumber String?
  tenantId        Int

  truckId              Int?
  truck                Truck?   @relation("TruckDrivers", fields: [truckId], references: [id])

  defaultForTruck      Truck?   @relation("DefaultDriver")

  trips                Trip[]

  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
}

model Truck {
  id                   Int      @id @default(autoincrement())
  tenantId        Int
  truckNumber          String
  truckCapacity        Int
  truckModel           String
  ownerPhoneNumber     String
  alternatePhoneNumber String?

  defaultDriverId      Int?     @unique
  defaultDriver        Driver?  @relation("DefaultDriver", fields: [defaultDriverId], references: [id])

  drivers              Driver[] @relation("TruckDrivers")
  trips                Trip[]

  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
}



model Shipment {
  id                Int @id @default(autoincrement())
  tenantId        Int
  shipmentDate      DateTime @default(now())
  businessId        Int
  business          Business @relation(fields: [businessId], references: [id])
  shippingAddressId Int
  shippingAddress   ShippingAddress @relation(fields: [shippingAddressId], references: [id])
  totalAmount       Decimal @db.Decimal(12, 2)
  shipmentItems     ShipmentItem[]
  tripShipments     TripShipment[]
  shipmentOtps      ShipmentOTP[]
  Status            Status @default(CREATED)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
}

model ShipmentItem {
  id          Int @id @default(autoincrement())
  tenantId        Int
  shipmentId Int
  shipment   Shipment @relation(fields: [shipmentId], references: [id])
  itemId     Int
  item       Item @relation(fields: [itemId], references: [id])
  quantity   Int
  itemRate   Decimal @db.Decimal(10, 2)
  subtotal   Decimal @db.Decimal(12, 2)
  createdAt  DateTime @default(now())
}

model Trip {
  id           Int @id @default(autoincrement())
  tripDate     DateTime @default(now())
  tenantId        Int
  Status       Status @default(ONTHEWAY)
  driverId     Int
  driver       Driver @relation(fields: [driverId], references: [id])
  truckId     Int
  truck       Truck @relation(fields: [truckId], references: [id])
  tripShipments TripShipment[]
  shipmentOtps ShipmentOTP[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}


model ShipmentOTP {
  id          Int      @id @default(autoincrement())
  tenantId        Int
  tripId      Int
  trip        Trip     @relation(fields: [tripId], references: [id])

  shipmentId  Int
  shipment    Shipment @relation(fields: [shipmentId], references: [id])

  otpCode     Int
  isVerified  Boolean  @default(false)

  expiresAt   DateTime

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([tripId, shipmentId])
}


model TripShipment {
  id          Int @id @default(autoincrement())
  tenantId        Int
  tripId      Int
  trip        Trip @relation(fields: [tripId], references: [id])

  shipmentId  Int
  shipment    Shipment @relation(fields: [shipmentId], references: [id])

  createdAt   DateTime @default(now())

  @@unique([tripId, shipmentId])
}


enum Status {
  CREATED
  ONTHEWAY
  COMPLETED
}



model User {
  id        Int      @id @default(autoincrement())
  tenantId  Int?     // optional: useful if you later scope data per tenant
  name      String
  email     String   @unique
  password  String
  role      Role     @default(ADMIN)
  
  isActive  Boolean  @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum Role {
  ADMIN
  USER
}